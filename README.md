# ìš”ê¸ˆ ì•ˆë‚´ AI ë°ëª¨

> **LangGraph**, **FastAPI**, ê·¸ë¦¬ê³  **React**ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì¶•ëœ **ì§€ëŠ¥í˜• ìš”ê¸ˆ ë¶„ì„ ë° ì•ˆë‚´ AI ì—ì´ì „íŠ¸** ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ë‹¨ìˆœíˆ ìš”ê¸ˆì œë¥¼ ì•ˆë‚´í•˜ëŠ” ê²ƒì„ ë„˜ì–´, ì‚¬ìš©ìì˜ ì‹¤ì œ ì²­êµ¬ ë‚´ì—­(Supabase DB)ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¡°íšŒí•˜ê³  **ìš”ê¸ˆ ì´ˆê³¼ ë°œìƒ ì›ì¸(API ì‚¬ìš©ëŸ‰, ë¶€ê°€ì„œë¹„ìŠ¤ ê°€ì… ë“±)ì„ ìŠ¤ìŠ¤ë¡œ ì¶”ë¡ **í•˜ì—¬ ë°ì´í„° ê¸°ë°˜ì˜ ë§ì¶¤í˜• ìƒë‹´ì„ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ”„ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë° ì„œë¹„ìŠ¤ í”Œë¡œìš°

### 1. ì „ì²´ ì‹œìŠ¤í…œ íë¦„

ì‚¬ìš©ìì˜ ì§ˆë¬¸ì´ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë°±ì—”ë“œë¡œ ì „ë‹¬ë˜ì–´ AI ì—ì´ì „íŠ¸ê°€ ë„êµ¬ë¥¼ ì„ íƒí•˜ê³  ë‹µë³€í•˜ëŠ” ì „ì²´ íë¦„ì…ë‹ˆë‹¤.

```mermaid
graph LR
    User((ì‚¬ìš©ì)) -- "1. ì§ˆë¬¸ ë©”ì‹œì§€" --> UI
  
    subgraph "Frontend Layer"
        UI[Chat Interface] -- "2. API ìš”ì²­" --> Client[Axios Client]
    end

    subgraph "Backend Layer"
        Client -- "3. POST /chat" --> Router[FastAPI Router]
        Router -- "4. ë©”ì‹œì§€ ì „ë‹¬" --> Agent[AI Agent]
        Agent -- "5. ë„êµ¬ ì„ íƒ ë° ì‹¤í–‰" --> Tools[Billing Tools]
    end

    subgraph "Data Layer"
        Tools <--> DB[(Supabase DB)]
    end

    Agent -- "6. ê²°ê³¼ ì·¨í•© ë° ë‹µë³€ ìƒì„±" --> Router
    Router -- "7. JSON ì‘ë‹µ" --> Client
    Client -- "8. ìƒíƒœ ì—…ë°ì´íŠ¸" --> UI
    UI -- "9. ìµœì¢… ë‹µë³€ ì¶œë ¥" --> User

    style User fill:#f9f,stroke:#333,stroke-width:2px
    style DB fill:#00f2fe,stroke:#333,stroke-width:2px
```

### 2. ì—ì´ì „íŠ¸ ì¶”ë¡  í”„ë¡œì„¸ìŠ¤ (ReAct Pattern)

AI ì—ì´ì „íŠ¸ê°€ íŒë‹¨í•˜ê³  ì—¬ëŸ¬ ë„êµ¬ë¥¼ ì‹¤í–‰í•˜ëŠ” ë‚´ë¶€ ë¡œì§ì…ë‹ˆë‹¤. ìµœê·¼ ì¶”ê°€ëœ **ë§ì¶¤ ìš”ê¸ˆì œ ì¶”ì²œ** ë° **ì‹¤ì‹œê°„ ìš”ê¸ˆì œ ì˜ˆì•½/ë³€ê²½** ê¸°ëŠ¥ê¹Œì§€ í¬í•¨ëœ ë‹¤ì–‘í•œ í”Œë¡œìš°ë¥¼ ì™„ë²½í•˜ê²Œ ì§€ì›í•©ë‹ˆë‹¤.

**âœ… ì‹œë‚˜ë¦¬ì˜¤ A: ìš”ê¸ˆ ìƒì„¸ ë¶„ì„ í”„ë¡œì„¸ìŠ¤**

```mermaid
sequenceDiagram
    participant U as ì‚¬ìš©ì
    participant A as AI ì—ì´ì „íŠ¸
    participant T as Tools (DB/Calc)
  
    U->>A: "2ì›” ìš”ê¸ˆì´ ì™œ ë§ì´ ë‚˜ì™”ì–´?"
    Note over A: 1. ì§ˆë¬¸ ì˜ë„ íŒŒì•…
    A->>T: fetch_billing_history(2ì›”) í˜¸ì¶œ
    T-->>A: {total: 69900, exceed_fee: 15000, ...} ë°˜í™˜
    Note over A: 2. ì´ˆê³¼ ìš”ê¸ˆ í™•ì¸ ë° ì¶”ê°€ ë¶„ì„ ê²°ì •
    A->>T: analyze_overage_cause(2ì›”) í˜¸ì¶œ
    T-->>A: {api_calls: 6000, addons: [...]} ë°˜í™˜
    Note over A: 3. ë°ì´í„° ì·¨í•© ë° ìµœì¢… ì¶”ë¡ 
    A->>U: "API í˜¸ì¶œ í•œë„ ì´ˆê³¼ ë° ì• ë“œì˜¨ í™œì„±í™”ê°€ ì›ì¸ì…ë‹ˆë‹¤. ì´ì•¡ì€ 69,900ì›ì…ë‹ˆë‹¤."
```

**âœ… ì‹œë‚˜ë¦¬ì˜¤ B: ë§ì¶¤ ì¶”ì²œ ë° ì›ê²© êµ¬ë… ë³€ê²½ í”„ë¡œì„¸ìŠ¤**

```mermaid
sequenceDiagram
    participant U as ì‚¬ìš©ì
    participant A as AI ì—ì´ì „íŠ¸
    participant T as Tools (DB/Calc)
  
    U->>A: "ì—°ê°„ ì˜ˆì‚° 20ë§Œì›ìœ¼ë¡œ ìš”ê¸ˆì œ ì¶”ì²œí•˜ê³  ë‹¤ìŒ ë‹¬ë¶€í„° ê·¸ê±¸ë¡œ ë°”ê¿”ì¤˜"
    Note over A: 1. ì˜ˆì‚° ê¸°ë°˜ ì¶”ì²œ ë„êµ¬ íŒë‹¨
    A->>T: recommend_plan_by_budget(budget=200000) í˜¸ì¶œ
    T-->>A: "ì—ì„¼ì…œ í”Œëœ + ë² ì´ì§ í•˜ì´ë¸Œë¦¬ë“œ ì¡°í•© ì¶”ì²œ" ë°˜í™˜
    Note over A: 2. ìš”ê¸ˆì œ ë³€ê²½ ë¡œì§ íŒë‹¨ (ì˜ˆì•½)
    A->>T: change_subscription_plan(new_plan="essential", status="reserved") í˜¸ì¶œ
    T-->>A: "DB ì—…ë°ì´íŠ¸ ì„±ê³µ (ë‹¤ìŒ ë‹¬ ì˜ˆì•½ ì™„ë£Œ)" ë°˜í™˜
    Note over A: 3. ìµœì¢… ê²°ê³¼ ì•ˆë‚´
    A->>U: "ì˜ˆì‚°ì— ë§ì¶° ì—ì„¼ì…œ í”Œëœì„ ì¶”ì²œí•´ ë“œë¦½ë‹ˆë‹¤. ë‹¤ìŒ ë‹¬ë¶€í„° í•´ë‹¹ í”Œëœìœ¼ë¡œ ë³€ê²½ë˜ë„ë¡ ì˜ˆì•½ ì²˜ë¦¬ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤."
```

### 3. LangGraph ê¸°ë°˜ ìš”ê¸ˆ Agent ì›Œí¬í”Œë¡œìš° ë¶„ì„

í˜„ì¬ Agent ì•„í‚¤í…ì²˜ëŠ” **ReAct(Reasoning and Acting) íŒ¨í„´**ì„ ì™„ë²½í•˜ê²Œ êµ¬í˜„í•˜ê³  ìˆìœ¼ë©°, ìœ ì—°ì„±ê³¼ ì•ˆì •ì„±(ë©”ëª¨ë¦¬ ì²´í¬í¬ì¸íŠ¸)ì„ ëª¨ë‘ í™•ë³´í•œ ìƒíƒœì…ë‹ˆë‹¤.

- **Reasoning (ìƒê° ë° íŒë‹¨):** LLM(`billing_assistant` ë…¸ë“œ)ì´ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ë¶„ì„í•˜ê³ , ì–´ë–¤ ë„êµ¬ë¥¼ ì¡°í•©í•´ ë¬¸ì œë¥¼ í•´ê²°í• ì§€ ìŠ¤ìŠ¤ë¡œ ê³„íší•©ë‹ˆë‹¤.
- **Routing (ì¡°ê±´ë¶€ ë¶„ê¸°):** `should_use_tool` í•¨ìˆ˜ë¥¼ í†µí•´ ë„êµ¬ ì‚¬ìš©ì´ í•„ìš”í•˜ë©´ `tool_executor` ë…¸ë“œë¡œ ë¼ìš°íŒ…í•˜ê³ , ìµœì¢… ë‹µë³€ì´ ì™„ì„±ë˜ë©´ ë£¨í”„ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.
- **Acting (ë„êµ¬ ì‹¤í–‰):** LLMì´ ìš”ì²­í•œ ë„êµ¬ë¥¼ ì‹¤í–‰(`tool_executor`)í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ ìƒíƒœ ë©”ëª¨ë¦¬ì— ì €ì¥í•©ë‹ˆë‹¤. ê²°ê³¼ëŠ” ë‹¤ì‹œ ì—ì´ì „íŠ¸ì—ê²Œ ì „ë‹¬ë˜ì–´ ì¬ì°¨ íŒë‹¨(Reasoning)ì— ì‚¬ìš©ë©ë‹ˆë‹¤.

### 4. ì„¸ë¶€ ë„êµ¬ (Custom Tools) ì„¤ê³„ í˜„í™©

Agentê°€ í™œìš©í•˜ëŠ” ë„êµ¬ë“¤ì€ ì—­í• ì— ë”°ë¼ ê¸°ëŠ¥ì ìœ¼ë¡œ ì™„ì „íˆ ë¶„ë¦¬ë˜ì–´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ LLMì˜ í™˜ê°ì„ ì œì–´í•˜ê³ , ì •í™•í•œ ë°ì´í„° ê¸°ë°˜ì˜ ìƒë‹´ì„ ì œê³µí•©ë‹ˆë‹¤.

| ë„êµ¬ëª… (í•¨ìˆ˜ëª…)                                 | ì•„í‚¤í…ì²˜ ë¶„ë¥˜                                                             | í•µì‹¬ ì—­í•                                                                 |
| :---------------------------------------------- | :------------------------------------------------------------------------ | :----------------------------------------------------------------------- |
| `calculate_billing,`recommend_plan_by_budget  | **Business Logic / Calculation Tools** (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë° ê³„ì‚° ë„êµ¬) | ë‚´ë¶€ ì—°ì‚°, ë‹¨ê°€ ì •ì±… ë°˜ì˜, í™˜ê° ë°©ì§€ ë° ë§ì¶¤í˜• í”Œëœ ì¶”ì²œ                 |
| `fetch_billing_history,`analyze_overage_cause | **Data Retrieval**(ë°ì´í„° ê²€ìƒ‰ ë„êµ¬)                                | ì™¸ë¶€ ë°ì´í„° ì—°ë™(Supabase DB), ì‚¬ì‹¤ ê¸°ë°˜ì˜ ìš”ê¸ˆ ì²­êµ¬ ë° ë¡œê·¸ ë°ì´í„° ê²€ìƒ‰ |
| `change_subscription_plan`                    | **Action / State Mutation Tools** (ìƒíƒœ ë³€ê²½ ë° ì‹¤í–‰ ë„êµ¬)          | ì‹¤ì§ˆì ì¸ ë°ì´í„° ë³€í™”(ì›”ë³„ ì—°ê³„ ìƒíƒœ ì—…ë°ì´íŠ¸) ìƒì„± ë° DB ë°˜ì˜            |

### 5. Pydantic ê¸°ë°˜ì˜ ë°ì´í„° ê²€ì¦ (Data Validation)

LangGraph ê¸°ë°˜ì˜ AI ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œì—ì„œ LLM(ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸)ì˜ ì¶œë ¥ì€ ë³¸ì§ˆì ìœ¼ë¡œ ë¹„ì •í˜• í…ìŠ¤íŠ¸ì´ë¯€ë¡œ 100% ì‹ ë¢°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë³¸ í”„ë¡œì íŠ¸ëŠ” **Pydanticì„ í™œìš©í•˜ì—¬ ì‹œìŠ¤í…œ ì „ì²´ì˜ ì•ˆì •ì„±ì„ ë³´ì¥**í•˜ê³  ìˆìŠµë‹ˆë‹¤.

- **AI ë„êµ¬(Tool) ì…ë ¥ê°’ ê²€ì¦**: `@tool(args_schema=...)` ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ LLMì´ ë„êµ¬(í•¨ìˆ˜)ë¥¼ í˜¸ì¶œí•  ë•Œ ì „ë‹¬í•˜ëŠ” ì¸ì(Arguments)ì˜ íƒ€ì…ê³¼ í˜•íƒœë¥¼ ì—„ê²©í•˜ê²Œ ì œí•œí•©ë‹ˆë‹¤. LLMì—ê²Œ í•„ë“œ ì„¤ëª…ì„ ëª…ì‹œ(ì˜ˆ: `budget: int = Field(...)`)í•˜ì—¬ ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ ì¶”ë¡ ì„ ìœ ë„í•˜ê³ , ì˜ëª»ëœ íƒ€ì…ì˜ ë°ì´í„°ë¥¼ ì‚¬ì „ì— ì°¨ë‹¨í•©ë‹ˆë‹¤.
- **API ê·œê²© ê²€ì¦ (FastAPI)**: í”„ë¡ íŠ¸ì—”ë“œì™€ í†µì‹ í•˜ëŠ” API ìš”ì²­/ì‘ë‹µ ì‹œì—ë„ `BaseModel`ì„ ìƒì†í•œ ìŠ¤í‚¤ë§ˆ(ì˜ˆ: `ChatRequest`)ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ ìš”ì²­ë§Œ ë°±ì—”ë“œ ë¡œì§ì— ë„ë‹¬í•˜ë„ë¡ í•˜ë©°, API ëª…ì„¸ì„œ(Swagger UI)ë¥¼ ìë™ ìƒì„±í•˜ëŠ” ì´ì ë„ í™•ë³´í–ˆìŠµë‹ˆë‹¤.

### 6. LLM-as-a-Judge ê¸°ë°˜ í‰ê°€ ìë™í™” (DeepEval)

ì—ì´ì „íŠ¸ ë‹µë³€ì˜ í’ˆì§ˆì„ ì§€ì†ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ **DeepEval í”„ë ˆì„ì›Œí¬**ë¥¼ ë„ì…í•˜ì—¬ `LLM-as-a-Judge` í‰ê°€ íŒŒì´í”„ë¼ì¸(`backend/eval/run_eval.py`)ì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.
í‰ê°€ ë°ì´í„°ì…‹ì€ Supabaseì˜ `evaluation_dataset` í…Œì´ë¸”ì—ì„œ ì¤‘ì•™ ê´€ë¦¬í•˜ë©°, ë‹¤ìŒê³¼ ê°™ì€ 5ê°œì˜ ë‹¤ë©´ì ì¸ ì»¤ìŠ¤í…€ ì§€í‘œ(GEval)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì±„ì í•˜ì—¬ ê°€ì¤‘ì¹˜ 100ì  ë§Œì ìœ¼ë¡œ í™˜ì‚°í•©ë‹ˆë‹¤.

- **ì •í•©ì„± (Groundedness, 25%)**: í™˜ê° ì—†ì´ ì£¼ì–´ì§„ ê²€ìƒ‰ ì»¨í…ìŠ¤íŠ¸(ê¸°ìˆ ë¬¸ì„œ, DBì¡°íšŒê²°ê³¼) ë‚´ì—ì„œë§Œ ë‹µë³€í–ˆëŠ”ê°€
- **ì¦ê±°ê°€ëŠ¥ì„± (Evidenceability, 15%)**: ë‹µë³€ì´ ì»¨í…ìŠ¤íŠ¸ì˜ êµ¬ì²´ì ì¸ ìˆ˜ì¹˜/ì„¹ì…˜ì„ ëª…ì‹œì ìœ¼ë¡œ ì°¸ì¡°í•˜ëŠ”ê°€
- **ëª…í™•ì„± (Clarity, 10%)**: ëª¨í˜¸í•œ ëŒ€ëª…ì‚¬ë¥¼ í”¼í•˜ê³  ë‹µë³€ ë²”ìœ„ê°€ ë¶„ëª…í•œê°€
- **ì›ìì„± (Atomicity, 10%)**: ë¶ˆí•„ìš”í•œ ë¶€ì—° ì„¤ëª… ì—†ì´ ì‚¬ìš©ìê°€ ìš”êµ¬í•œ ë‹¨ì¼ ê³¼ì—…ì—ë§Œ ì§‘ì¤‘í–ˆëŠ”ê°€
- **ì˜ë¯¸ê°•ê±´ì„± (Semantic Robustness, 5%)**: ë‹¨ìˆœ í‚¤ì›Œë“œ ë§¤ì¹­ì´ ì•„ë‹Œ ì‚¬ìš©ì ì§ˆë¬¸ì˜ ìˆ¨ì€ ì˜ë„ë¥¼ íŒŒì•…í–ˆëŠ”ê°€

> *í‰ê°€ ë¡œì§ ìµœì í™”*: Google Geminiì˜ `2.5-flash` ëª¨ë¸ì„ í‰ê°€ì(Judge)ë¡œ ì§€ì •í•˜ê³  API Rate Limit ë°©ì–´ ë¡œì§(ë¹„ë™ê¸° ëŒ€ê¸° ë° ì¬ì‹œë„)ì„ ì ìš©í•˜ì˜€ìœ¼ë©°, `rich` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ í„°ë¯¸ë„ í”„ë¡œê·¸ë˜ìŠ¤ ë°” ë° ê²°ê³¼ í…Œì´ë¸” UIë¥¼ ì œê³µí•©ë‹ˆë‹¤.

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡° (Project Structure)

ì „ì²´ í”„ë¡œì íŠ¸ëŠ” í¬ê²Œ ë°±ì—”ë“œ(Python), í”„ë¡ íŠ¸ì—”ë“œ(React), ê·¸ë¦¬ê³  ì¸í”„ë¼ ì„¤ì •ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```text

â”œâ”€â”€ backend/               # ì—ì´ì „íŠ¸ ë¡œì§ ë° API ì„œë²„ (FastAPI + LangGraph)
â”‚   â”œâ”€â”€ eval/              # LLM-as-a-Judge í‰ê°€ íŒŒì´í”„ë¼ì¸ (DeepEval)
â”‚   â”‚   â”œâ”€â”€ eval_metrics.py # ì»¤ìŠ¤í…€ í‰ê°€ ì§€í‘œ(GEval) ì •ì˜
â”‚   â”‚   â””â”€â”€ run_eval.py    # í‰ê°€ ì‹¤í–‰ ë° ê²°ê³¼ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ main.py            # í•µì‹¬ AI ë¡œì§ ë° ì—”ë“œí¬ì¸íŠ¸
â”‚   â””â”€â”€ README.md          # ë°±ì—”ë“œ ìƒì„¸ ê¸°ìˆ  ë¬¸ì„œ
â”œâ”€â”€ frontend/              # ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ (React + Vite)
â”‚   â”œâ”€â”€ src/               # React ì»´í¬ë„ŒíŠ¸ ë° UI ë¡œì§
â”‚   â”œâ”€â”€ Dockerfile.dev     # ì‹¤ì‹œê°„ ì½”ë“œ ë°˜ì˜(HMR) ê°œë°œìš© ì„¤ì •
â”‚   â””â”€â”€ README.md          # í”„ë¡ íŠ¸ì—”ë“œ ìƒì„¸ ê°€ì´ë“œ
â”œâ”€â”€ Dockerfile.backend     # ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ ë¹Œë“œ ì„¤ì •
â”œâ”€â”€ docker-compose.yml     # ë°±ì—”ë“œ-í”„ë¡ íŠ¸ì—”ë“œ í†µí•© ìš´ì˜ ì„¤ì •
â”œâ”€â”€ pyproject.toml         # Python í”„ë¡œì íŠ¸ ì„¤ì • ë° ì˜ì¡´ì„± (uv)
â””â”€â”€ run.sh                 # ë¡œì»¬ í™˜ê²½ í†µí•© ì‹¤í–‰ìš© ìŠ¤í¬ë¦½íŠ¸
```

---

## ğŸ³ Docker ì„¤ì •

> Docker Composeë¥¼ ì‚¬ìš©í•˜ë©´ ë³„ë„ì˜ ë¡œì»¬ ì„¤ì • ì—†ì´ ì „ì²´ ì„œë¹„ìŠ¤ë¥¼ ì¼ê´„ì ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1. Docker í™˜ê²½ ì¤€ë¹„

> ì²˜ìŒ Dockerë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ì•„ë˜ ëª…ë ¹ì–´ë¡œ í•„ìš”í•œ íˆ´ì„ ì„¤ì¹˜í•˜ê³  ê¶Œí•œì„ ì„¤ì •í•˜ì„¸ìš”.

```bash
# Docker ë° Compose ì„¤ì¹˜ (Ubuntu/WSL)
sudo apt-get update && sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin

# 1. ê¶Œí•œ ì˜êµ¬ ì„¤ì • (sudo ì—†ì´ ì‚¬ìš©)
sudo usermod -aG docker $USER
newgrp docker  # í˜„ì¬ í„°ë¯¸ë„ì— ì¦‰ì‹œ ë°˜ì˜ (ë˜ëŠ” WSL ì¬ì‹œì‘)

# 2. ì„œë¹„ìŠ¤ ì‹œì‘
sudo service docker start
```

### 2. WSL2 Docker ìë™ ì‹œì‘ ì„¤ì • (ì„ íƒ ì‚¬í•­)

WSL2 í™˜ê²½ì—ì„œëŠ” ì‹œìŠ¤í…œ ì‹œì‘ ì‹œ Dockerê°€ ìë™ìœ¼ë¡œ ì¼œì§€ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‰˜ ì„¤ì • íŒŒì¼(`~/.zshrc` ë˜ëŠ” `~/.bashrc`) ë§¨ í•˜ë‹¨ì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•˜ë©´ í„°ë¯¸ë„ ì‹¤í–‰ ì‹œ ìë™ìœ¼ë¡œ Dockerë¥¼ í™•ì¸í•˜ê³  ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
# ~/.zshrc ë˜ëŠ” ~/.bashrc í•˜ë‹¨ì— ì¶”ê°€
if ! service docker status > /dev/null 2>&1; then
    echo "ğŸ³ Starting Docker service..."
    sudo service docker start
fi
```

### 2. ë¹Œë“œ ë° ì‹¤í–‰

```bash
docker compose build   # ì´ë¯¸ì§€ ë¹Œë“œ
docker compose up -d    # ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
```

### 3. ìƒíƒœ ë° ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸

```bash
docker compose ps               # ì‹¤í–‰ ì»¨í…Œì´ë„ˆ í™•ì¸
docker compose logs -f          # ì „ì²´ ì‹¤ì‹œê°„ ë¡œê·¸
docker compose logs -f server   # ë°±ì—”ë“œ ë¡œê·¸ë§Œ ê³„ì† ë³´ê¸°
```

### 4. ì½”ë“œ ìˆ˜ì • ë° ì‹¤ì‹œê°„ ë°˜ì˜

* **ë°±ì—”ë“œ**: `backend/main.py` íŒŒì¼ í•˜ë‹¨ì˜ `reload=True` ì„¤ì •ê³¼ ë³¼ë¥¨ ë§ˆìš´íŠ¸ ë•ë¶„ì— ì½”ë“œ ìˆ˜ì • ì‹œ **ìë™ìœ¼ë¡œ ì¬ì‹œì‘**ë©ë‹ˆë‹¤.
* **í”„ë¡ íŠ¸ì—”ë“œ**: `frontend/Dockerfile.dev`ë¥¼ ì‚¬ìš©í•˜ì—¬ Vite ê°œë°œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. ì†ŒìŠ¤ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ë©´ **HMR(Hot Module Replacement)**ì„ í†µí•´ ë¸Œë¼ìš°ì €ì— ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.

  * *ì°¸ê³ : ê¸°ì¡´ `frontend/Dockerfile`ì€ Nginx ê¸°ë°˜ì˜ ë°°í¬ìš© ì„¤ì •ì´ë©°, í˜„ì¬ëŠ” ì‹¤ì‹œê°„ ìˆ˜ì •ì„ ìœ„í•´ `Dockerfile.dev`ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.*
* docker ì„œë¹„ìŠ¤ ì‹œì‘:

```bash
sudo service docker start
```

* ê¶Œí•œ ë¬¸ì œ ë°œìƒì‹œ ì†Œì¼“ ê¶Œí•œ ì„¤ì •

```bash
sudo chmod 666 /var/run/docker.sock
```

* ì¬ì‹œì‘ì´ í•„ìš”í•œ ê²½ìš°:

```bash
docker compose restart          # ì „ì²´ ì¬ì‹œì‘
docker compose restart server   # ë°±ì—”ë“œ ì¬ì‹œì‘
docker compose restart client   # í”„ë¡ íŠ¸ì—”ë“œ ì¬ì‹œì‘
```

* ì¼ì‹œì •ì§€ í•„ìš”í•œ ê²½ìš°:

```bash
docker compose pause          # ì „ì²´ ì¼ì‹œì •ì§€
docker compose pause server   # ë°±ì—”ë“œ ì¼ì‹œì •ì§€
docker compose pause client   # í”„ë¡ íŠ¸ì—”ë“œ ì¼ì‹œì •ì§€
```

* ì¼ì‹œì •ì§€ í•´ì œ í•„ìš”í•œ ê²½ìš°:

```bash
docker compose unpause          # ì „ì²´ ì¼ì‹œì •ì§€ í•´ì œ
docker compose unpause server   # ë°±ì—”ë“œ ì¼ì‹œì •ì§€ í•´ì œ
docker compose unpause client   # í”„ë¡ íŠ¸ì—”ë“œ ì¼ì‹œì •ì§€ í•´ì œ
```

* ì¤‘ì§€ í•„ìš”í•œ ê²½ìš°:

```bash
docker compose stop          # ì „ì²´ ì¤‘ì§€
docker compose stop server   # ë°±ì—”ë“œ ì¤‘ì§€
docker compose stop client   # í”„ë¡ íŠ¸ì—”ë“œ ì¤‘ì§€
```

* ì¬ì‹œì‘ í•„ìš”í•œ ê²½ìš°:

```bash
docker compose start          # ì „ì²´ ì¬ì‹œì‘
docker compose start server   # ë°±ì—”ë“œ ì¬ì‹œì‘
docker compose start client   # í”„ë¡ íŠ¸ì—”ë“œ ì¬ì‹œì‘
```

### 5. ë¶ˆí•„ìš” ë„ì»¤ ì´ë¯¸ì§€ ì‚­ì œ

```bash
docker rmi ID # ì˜ˆì‹œ: docker rmi b75a6bc59bf1
```

### 6. í…ŒìŠ¤íŠ¸ ê²½ë¡œ

* **í”„ë¡ íŠ¸ì—”ë“œ**: [Web](http://172.25.231.60:5173/)
* **ë°±ì—”ë“œ API**: [FastAPI - Swagger UI](http://172.25.231.60:8000/docs#/default/health_check_health_get)

---

## ë¡œì»¬ ê°œë°œ ê°€ì´ë“œ

ê°œë°œ ì¤‘ ì‹¤ì‹œê°„ ì½”ë“œ ë°˜ì˜(HMR)ì„ ì›í•˜ì‹œë©´ ë¡œì»¬ í™˜ê²½ì—ì„œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

### í†µí•© ì‹¤í–‰ (Script)

í„°ë¯¸ë„ ì°½ í•˜ë‚˜ì—ì„œ ë°±ì—”ë“œì™€ í”„ë¡ íŠ¸ì—”ë“œë¥¼ ë™ì‹œì— ë„ì›ë‹ˆë‹¤.

```bash
chmod +x run.sh
./run.sh
```

### ê°œë³„ ì‹¤í–‰ (Manual)

#### âš™ï¸ Backend (Python/FastAPI)

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰
uv sync                # ì˜ì¡´ì„± ì„¤ì¹˜
uv run python backend/main.py
```

ğŸ‘‰ ìƒì„¸ ë‚´ìš©ì€ [backend/README.md](./backend/README.md) ì°¸ê³ 

#### ğŸ¨ Frontend (React/Vite)

```bash
cd frontend
npm install            # íŒ¨í‚¤ì§€ ì„¤ì¹˜
npm run dev
```

ğŸ‘‰ ìƒì„¸ ë‚´ìš©ì€ [frontend/README.md](./frontend/README.md) ì°¸ê³ 

---

## ì£¼ìš” ê¸°ëŠ¥ (Core Features)

- **AI ìƒë‹´ ì—ì´ì „íŠ¸**: LangGraph ReAct íŒ¨í„´ì„ ì‚¬ìš©í•œ ì§€ëŠ¥í˜• ë„êµ¬ ì„ íƒ
- ** ìš”ê¸ˆ ìë™ ê³„ì‚°**: `calculate_billing` ë„êµ¬ë¡œ ë³µìˆ˜ í”Œëœ ì‚¬ìš© ì‹œ í•©ê³„ ì‚°ì¶œ
- ** ì˜ˆì‚° ë§ì¶¤ ì¶”ì²œ**: `recommend_plan_by_budget` ë„êµ¬ë¡œ ìµœì  ìš”ê¸ˆì œ ì œì•ˆ
- ** ë°ì´í„° ê¸°ë°˜ ì¡°íšŒ ë° ë¶„ì„**: Supabase DBì™€ ì—°ë™í•˜ì—¬ ì²­êµ¬ ìƒì„¸ ë‚´ì—­ê³¼ ì´ˆê³¼ ì‚¬ìœ  ë¡œê·¸ ë¶„ì„ (`fetch_billing_history`, `analyze_overage_cause`)
- ** ì•¡ì…˜ ë° ìƒíƒœ ë³€ê²½ (Mutation)**: ì‚¬ìš©ìì˜ ìš”ì²­ì— ë”°ë¼ ì¦‰ì‹œ ë˜ëŠ” ì§€ì •ëœ ì›”ë¶€í„° êµ¬ë… ìš”ê¸ˆì œë¥¼ ë³€ê²½ ë° ì˜ˆì•½í•˜ê³  ë³€ê²½ ì´ë ¥ì„ DBì— ê´€ë¦¬ (`change_subscription_plan`)
- **ì‹¤ì‹œê°„ ì±„íŒ… UI**: Framer Motion ì• ë‹ˆë©”ì´ì…˜ì´ ì ìš©ëœ UI/UX

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ (Tech Stack)

| ê³„ì¸µ (Layer)            | ì„¸ë¶€ ê¸°ìˆ  (Technologies)                                      | 
| :---------------------- | :---------------------------------------------------------- |
| **Model**               | Google Gemini 2.5 Flash/ gemini-3-flash-preview                         |
| **Orchestration**       | LangChain, LangGraph (ReAct Pattern, MemorySaver)           |
| **Backend**             | Python 3.12, FastAPI, Uvicorn, Pydantic                     |
| **Frontend**            | React 18, Vite, Tailwind CSS v4, Framer Motion              |
| **Database**            | Supabase (PostgreSQL - `billing_history`, `evaluation_dataset`) |
| **Eval (LLM-as-a-Judge)**| DeepEval                                     |
| **DevOps & Package**    | Docker, Docker Compose, uv (Python), npm (Node)             |

---

## ğŸ”Œ API ëª…ì„¸ ìš”ì•½ (API Usage)

### POST `/chat`

ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ì²˜ë¦¬í•˜ê³  ëŒ€í™” ì´ë ¥ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

**Request:**

```json
{
  "message": "í”„ë¡œ ìš”ê¸ˆì œ 3ê°œì›” ê°€ê²© ì–¼ë§ˆì•¼?",
  "thread_id": "user_session_1"
}
```

**Response:**

```json
[
  { "role": "user", "content": "í”„ë¡œ ìš”ê¸ˆì œ 3ê°œì›” ê°€ê²© ì–¼ë§ˆì•¼?" },
  { "role": "assistant", "content": "í”„ë¡œ ìš”ê¸ˆì œëŠ” ì›” 29,900ì›ì´ë©°, 3ê°œì›” ì´ì•¡ì€ 89,700ì›ì…ë‹ˆë‹¤." }
]
```

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

**Supabase í…Œì´ë¸”: `billing_history`**

| ì»¬ëŸ¼                  | íƒ€ì…            | ì„¤ëª…                                                         |
| :-------------------- | :-------------- | :----------------------------------------------------------- |
| `user_id`           | `text`        | ì‚¬ìš©ì ì‹ë³„ (ì˜ˆ: user_123)                                   |
| `billing_month`     | `text`        | ì²­êµ¬ ë‹¬ (ì˜ˆ: 2026-02)                                        |
| `details`           | `jsonb`       | ìš”ê¸ˆ ìƒì„¸ (total, base_fee, discount ë“±)                     |
| `subscription_info` | `jsonb`       | êµ¬ë… ìƒíƒœ(current_plan ë“±) ë° ë³€ê²½ ì´ë ¥(change_history) ì •ë³´ |
| `created_at`        | `timestamptz` | ë°ì´í„° ìƒì„± ì¼ì‹œ                                             |

<br>

**Supabase í…Œì´ë¸”: `evaluation_dataset` (LLM í‰ê°€ìš©)**

| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
| :--- | :--- | :--- |
| `id` | `uuid` (PK) | í‰ê°€ ë°ì´í„° ì„¸íŠ¸ ê³ ìœ  ì‹ë³„ì |
| `question` | `text` | í‰ê°€ì— ì‚¬ìš©ë˜ëŠ” ì§ˆë¬¸ (ì‚¬ìš©ì ë°œí™” ëª¨ì‚¬) |
| `expected_answer` | `text` | ì •ë‹µ ë° ëª¨ë²” ê°€ì´ë“œë¼ì¸ (Robustness ê²€ì¦ìš©) |
| `topic_path` | `jsonb` | ì•ˆë‚´ ì¹´í…Œê³ ë¦¬ ê³„ì¸µ êµ¬ì¡° (ì˜ˆ: `ìš”ê¸ˆ > ëª¨ë°”ì¼...`) |
| `context_references` | `jsonb` | í•„ìˆ˜ ì°¸ì¡° ë¬¸ì„œ í˜¹ì€ ë„êµ¬ëª… (Groundedness ê²€ì¦ìš©) |
| `intent_type` | `text` | ì‚¬ìš©ìì˜ í•µì‹¬ ì§ˆë¬¸ ì˜ë„ëª… (Factoid, Compare ë“±) |
| `created_at` | `timestamptz` | ì—­ëŒ€ í‰ê°€ ë‚´ì—­ ìƒì„± ì¼ì‹œ |

---

## ğŸ’¡ ì°¸ê³ : í”„ë¡ íŠ¸ì—”ë“œ ëª¨ë“œ ì „í™˜ (Development vs Production)

í˜„ì¬ `docker-compose.yml`ì€ ì‹¤ì‹œê°„ ì½”ë“œ ìˆ˜ì •ì„ ìœ„í•´ **ê°œë°œ ëª¨ë“œ**ë¡œ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ìƒí™©ì— ë”°ë¼ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1. ê°œë°œ ëª¨ë“œ (ê¸°ë³¸ê°’)

- **íŠ¹ì§•**: ì½”ë“œ ìˆ˜ì • ì‹œ ì¦‰ì‹œ ë°˜ì˜(HMR), Vite ê°œë°œ ì„œë²„ ì‚¬ìš©
- **ì„¤ì •**:
  - `dockerfile: Dockerfile.dev`
  - `ports: - "5173:5173"`
  - `volumes: - ./frontend:/app` í™œì„±í™”

### 2. í”„ë¡œë•ì…˜ ëª¨ë“œ (ë°°í¬ í…ŒìŠ¤íŠ¸ìš©)

- **íŠ¹ì§•**: ë¹Œë“œëœ ì •ì  íŒŒì¼ì„ Nginxê°€ ì„œë¹™, ë³´ì•ˆ ë° ì„±ëŠ¥ ìµœì í™” ìƒíƒœ í™•ì¸ ê°€ëŠ¥
- **ì„¤ì • ë³€ê²½ ë°©ë²•**:
  1. `docker-compose.yml`ì—ì„œ `dockerfile: Dockerfile.dev`ë¥¼ ì£¼ì„ ì²˜ë¦¬í•˜ê³  `dockerfile: Dockerfile` ì£¼ì„ì„ í•´ì œí•©ë‹ˆë‹¤.
  2. `ports` ì„¤ì •ì„ `5173:80`ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
  3. `volumes` ì„¤ì •ì„ ì£¼ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤ (ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ).
  4. `docker compose up -d --build` ëª…ë ¹ì–´ë¡œ ì¬ë¹Œë“œ ë° ì‹¤í–‰í•©ë‹ˆë‹¤.

---

## ğŸš€ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ ë°°í¬ (Deployment)

ì´ í”„ë¡œì íŠ¸ëŠ” í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œë¥¼ ê°ê° ë¶„ë¦¬í•˜ì—¬ ìµœì‹  í´ë¼ìš°ë“œ í”Œë«í¼ì— ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1. ë°±ì—”ë“œ ë°°í¬ (Render.com)

ë°±ì—”ë“œëŠ” Docker í™˜ê²½ ì§€ì›ì´ ìš°ìˆ˜í•œ **Render**ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬´ë£Œë¡œ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. **Render**ì— ê°€ì… í›„ **"New Web Service"**ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
2. GitHub Repositoryë¥¼ ì—°ë™í•©ë‹ˆë‹¤.
3. ì„¤ì •ê°’ì„ ë‹¤ìŒê³¼ ê°™ì´ ì§€ì •í•©ë‹ˆë‹¤:
   - **Environment**: `Docker`
   - **Root Directory**: `.` (ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ìœ ì§€)
   - **Dockerfile Path**: `./Dockerfile.backend`
   - **Environment Variables**: ë¡œì»¬ `.env`ì— ì •ì˜ëœ ë³€ìˆ˜ë“¤ì„ ëª¨ë‘ ì…ë ¥ (ì˜ˆ: `GEMINI_API_KEY`, `SUPABASE_URL` ë“±)
4. ë°°í¬ê°€ ì™„ë£Œë˜ë©´ `https://your-service-name.onrender.com` ê³¼ ê°™ì€ URLì´ ë°œê¸‰ë©ë‹ˆë‹¤.

### 2. í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ (Vercel)

í”„ë¡ íŠ¸ì—”ë“œëŠ” React/Vite í˜¸ìŠ¤íŒ…ì— ìµœì í™”ëœ **Vercel**ì„ ì‚¬ìš©í•˜ì—¬ ë¹ ë¥´ê³  ì‰½ê²Œ ë°°í¬í•©ë‹ˆë‹¤.

1. **Vercel**ì— ê°€ì… í›„ **"Add New Project"**ë¥¼ í´ë¦­í•˜ì—¬ GitHub Repositoryë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
2. ì„¤ì •ê°’ì„ ë‹¤ìŒê³¼ ê°™ì´ ì§€ì •í•©ë‹ˆë‹¤:
   - **Framework Preset**: `Vite` (ìë™ ê°ì§€ë¨)
   - **Root Directory**: `frontend`
3. **Environment Variables**ì— ë‹¤ìŒì„ ì¶”ê°€í•©ë‹ˆë‹¤:
   - **Key**: `VITE_API_URL`
   - **Value**: Renderì—ì„œ ë°œê¸‰ë°›ì€ ë°±ì—”ë“œ URL (`https://your-service-name.onrender.com`)
4. **Deploy** ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
5. ë°°í¬ê°€ ì™„ë£Œë˜ë©´ ê¸€ë¡œë²Œ ì—£ì§€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì„œë¹„ìŠ¤ë˜ëŠ” í”„ë¡ íŠ¸ì—”ë“œ ì£¼ì†Œë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ì£¼ì†Œê°€ ë³€ê²½ëœ ê²½ìš° Vercel í™˜ê²½ ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•œ ë’¤ **Redeploy**ë§Œ ì§„í–‰í•˜ë©´ ë©ë‹ˆë‹¤.
